<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Falling - Kirby</title>
<style>
  * { box-sizing:border-box; margin:0; padding:0; font-family: Arial, sans-serif; }
  html, body {
    height:100%; width:100%;
    display:flex; flex-direction:column; align-items:center; justify-content:center;
    background: radial-gradient(circle at top, #1a237e, #0d133d);
    color:#fff; position:relative; overflow:hidden;
  }
  body::before {
    content:"";
    position:absolute;
    width:200%; height:200%;
    background: radial-gradient(circle, #3949ab33, #1a237e22 70%, transparent 90%);
    animation: rotateBg 25s linear infinite;
    z-index:-1;
  }
  @keyframes rotateBg { 0%{transform:rotate(0deg);} 100%{transform:rotate(360deg);} }

  .game-container {
    position: relative;
    padding: 30px; /* aumentei o padding */
    border: 2px solid rgba(255,255,255,0.25);
    border-radius: 20px;
    backdrop-filter: blur(15px);
    background: rgba(255,255,255,0.08);
    box-shadow: 0 10px 40px rgba(0,0,0,0.7);
    display:flex; flex-direction:column; align-items:center;
    max-width: 800px; /* maior que antes */
    width: 95%;
}

.backBtn {
    position: absolute; top:5px; left:10px; /* mais para cima */
    padding:10px 20px;
    background: linear-gradient(145deg, #3f51b5, #1a237e); /* cor original */
    color: #fff;
    font-weight: bold;
    border:none; border-radius:15px;
    cursor:pointer; z-index:10;
    transition: all 0.3s ease;
}
.backBtn:hover { 
    transform: scale(1.05); 
    background: linear-gradient(145deg, #1a237e, #283593); 
}

  h2 {
    text-align:center;
    color:#fff;
    margin:15px 0;
    font-size: clamp(1.2rem, 3vw, 1.8rem); /* título menor */
    text-shadow: none; /* remove efeito rosa */
  }

  .hud {
    display:flex; justify-content:center; gap:30px;
    font-size:clamp(1.2rem,2vw,2rem);
    margin:10px 0; flex-wrap:wrap;
  }
  .hud div {
    padding:10px 16px;
    border:2px solid #122231; border-radius:6px;
    background-color:#0f1724; min-width:120px;
    text-align:center; color:#fff;
  }

  #gameWrapper {
    width:100%; max-width:690px;
    aspect-ratio:1/1;
    border:6px solid #000;
    border-radius:15px;
    box-shadow:0 0 25px #000, 0 0 50px #000 inset;
    background: url('back.png') no-repeat center center;
    background-size: cover;
    position: relative;
    margin-bottom:20px;
  }
  canvas { width:100%; height:100%; border-radius:12px; display:block; }

  #pausedOverlay {
    position: absolute;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: rgba(0,0,0,0.7);
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: clamp(2rem, 5vw, 4rem);
    color: #f17bb4;
    text-align:center;
    display: none;
    pointer-events: none;
    font-weight: bold;
    letter-spacing: 3px;
  }

  #controls {
    text-align:center; margin-bottom:10px;
  }
  #controls button {
    font-size: clamp(0.9rem, 2vw, 1.3rem);
    padding:6px 12px;
    margin:0 5px;
    border:none;
    border-radius:8px;
    background:#0c1118; /* botão start escuro */
    color:#fff;
    font-weight:bold;
    cursor:pointer;
    transition: all 0.3s ease;
  }
  #controls button:hover { transform:scale(1.05); }

  .other-games {
    display:flex; gap:15px; flex-wrap:wrap; justify-content:center; margin-top:15px;
  }
  .other-games button {
    padding:12px 25px;
    font-size:1.1rem;
    border:none;
    border-radius:15px;
    cursor:pointer;
    background: linear-gradient(145deg, #3f51b5, #1a237e);
    color:#fff;
    box-shadow:0 8px 25px rgba(0,0,0,0.6);
    transition: all 0.3s ease;
  }
  .other-games button:hover {
    transform: scale(1.05);
    background: linear-gradient(145deg, #1a237e, #283593);
  }
</style>
</head>
<body>
<div class="game-container">
  <button class="backBtn" onclick="goBack()">Voltar</button>

  <h2>Kirby odeia bananas! Coma os inimigos e desvie das bananas!</h2>

  <div class="hud">
    <div>Pontos: <span id="score">0</span></div>
    <div>Vidas: <span id="lives">3</span></div>
  </div>

  <div id="gameWrapper">
    <canvas id="gameCanvas"></canvas>
    <div id="pausedOverlay">PAUSE</div>
  </div>

  <div id="controls">
    <button id="startBtn">Start</button>
    <button id="restartBtn" style="display:none;">Reiniciar</button>
  </div>

  <div class="other-games">
    <button onclick="window.location.href='snake.html'">Cobrinha</button>
    <button onclick="window.location.href='jogoVelha.html'">Jogo da Velha</button>
  </div>
</div>

<audio id="bgMusic" src="Fundo.mp3" loop></audio>
<audio id="scoreSound" src="Ponto.mp3"></audio>
<audio id="hitSound" src="Dano.mp3"></audio>

<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");
const hud = document.getElementById("hud");
const startBtn = document.getElementById("startBtn");
const restartBtn = document.getElementById("restartBtn");
const bgMusic = document.getElementById("bgMusic");
const scoreSound = document.getElementById("scoreSound");
const hitSound = document.getElementById("hitSound");
const pausedOverlay = document.getElementById("pausedOverlay");

const kirbyImg = new Image(); kirbyImg.src = 'Kirby.png';
const bananaImg = new Image(); bananaImg.src = 'banana.png';
const enemyImgs = [
  {img:new Image(), speedFactor:0.004},
  {img:new Image(), speedFactor:0.0045},
  {img:new Image(), speedFactor:0.0035}
];
enemyImgs[0].img.src = 'Inimigo1.png';
enemyImgs[1].img.src = 'Inimigo2.png';
enemyImgs[2].img.src = 'Inimigo3.png';

let player = {x:0, y:0, w:0, h:0, speed:0};
let objects = [];
let score = 0, lives = 3;
let running = false, gameOver = false;
let lastSpawn = 0, spawnInterval = 1000;
let keys = {left:false, right:false};
let isPaused = false;

function updateHUD(){ 
  document.getElementById("score").textContent = score;
  document.getElementById("lives").textContent = lives;
}
function rectCollide(a,b){ return a.x < b.x+b.w && a.x+a.w > b.x && a.y < b.y+b.h && a.y+a.h > b.y; }

function spawnObject(){
  const size = canvas.width * 0.08;
  const randX = Math.random()*(canvas.width-size);
  const rand = Math.random();
  let obj = {};
  if(rand<0.6){
    const enemyIndex = Math.floor(Math.random()*enemyImgs.length);
    obj = {x:randX, y:-size, w:size, h:size, vy:enemyImgs[enemyIndex].speedFactor*canvas.width, type:"enemy", img:enemyImgs[enemyIndex].img };
  } else {
    obj = {x:randX, y:-size, w:size, h:size, vy:0.003*canvas.width*(2+Math.random()*2), type:"banana", img:bananaImg };
  }
  objects.push(obj);
}

function update(delta){
  if(!running || isPaused) return;
  lastSpawn += delta;
  if(lastSpawn>spawnInterval){ spawnObject(); lastSpawn=0; spawnInterval=Math.max(500, spawnInterval-5); }

  if(keys.left) player.x -= player.speed*(delta/16);
  if(keys.right) player.x += player.speed*(delta/16);
  if(player.x<0) player.x=0;
  if(player.x+player.w>canvas.width) player.x=canvas.width-player.w;

  for(let i=objects.length-1;i>=0;i--){
    const obj=objects[i];
    obj.y += obj.vy*(delta/16);
    if(rectCollide(player,obj)){
      if(obj.type==="enemy"){ 
        score++; 
        scoreSound.currentTime=0; 
        scoreSound.play(); 
      } else { 
        lives--; 
        hitSound.currentTime=0; 
        hitSound.play(); 
        if(lives<=0){endGame(); return;} 
      }
      objects.splice(i,1);
      updateHUD();
      continue;
    }
    if(obj.y>canvas.height) objects.splice(i,1);
  }
}

function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.drawImage(kirbyImg, player.x, player.y, player.w, player.h);
  for(const obj of objects){ 
    ctx.drawImage(obj.img, obj.x, obj.y, obj.w, obj.h); 
  }
}

let lastTime=0;
function loop(ts){
  if(!running) return;
  if(!lastTime) lastTime=ts;
  const delta=ts-lastTime;
  lastTime=ts;
  update(delta);
  draw();
  requestAnimationFrame(loop);
}

function startGame(){
  objects=[]; score=0; lives=3; running=true; gameOver=false; lastSpawn=0; spawnInterval=1000;
  resizeCanvas();
  player.x = (canvas.width - player.w) / 2;
  player.y = canvas.height - player.h - 10;
  updateHUD();
  bgMusic.currentTime=0; bgMusic.play().catch(()=>{});
  pausedOverlay.style.display = "none";
  isPaused=false; lastTime=0;
  requestAnimationFrame(loop);
  startBtn.style.display="none";
  restartBtn.style.display="none";
}

function endGame(){
  running=false; gameOver=true; bgMusic.pause();
  restartBtn.style.display="inline-block";
  pausedOverlay.style.display="none";
}

window.addEventListener("keydown", e=>{
  if(e.key==="ArrowLeft"||e.key==="a") keys.left=true;
  if(e.key==="ArrowRight"||e.key==="d") keys.right=true;
  if(e.code==="Space"){ 
    if(running){ 
      isPaused = !isPaused; 
      pausedOverlay.style.display = isPaused ? "flex" : "none"; 
    } 
  }
});
window.addEventListener("keyup", e=>{
  if(e.key==="ArrowLeft"||e.key==="a") keys.left=false;
  if(e.key==="ArrowRight"||e.key==="d") keys.right=false;
});

function resizeCanvas(){
  const wrapper = document.getElementById("gameWrapper");
  canvas.width = wrapper.clientWidth;
  canvas.height = wrapper.clientHeight;
  player.w = canvas.width*0.12;
  player.h = canvas.width*0.12;
  player.speed = canvas.width*0.015;
  objects.forEach(obj=>{
    obj.w = canvas.width*0.08;
    obj.h = canvas.width*0.08;
    obj.vy = obj.type==="enemy"?0.004*canvas.width:0.003*canvas.width*(2+Math.random()*2);
  });
}

window.addEventListener("resize", resizeCanvas);
resizeCanvas();
startBtn.addEventListener("click",()=>startGame());
restartBtn.addEventListener("click",()=>startGame());
function goBack(){ window.location.href='index.html'; bgMusic.pause(); }
updateHUD();
</script>
</body>
</html>

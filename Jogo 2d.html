<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Corrida Noturna</title>
<style>
body {
  margin:0; 
  overflow:hidden; 
  background:#0f172a; 
  font-family:Arial, sans-serif; 
  color:white;
}
#hud {
  position:absolute; 
  top:10px; 
  left:50%; 
  transform:translateX(-50%); 
  background:rgba(0,0,0,0.6); 
  padding:10px 25px; 
  border-radius:10px; 
  font-size:20px; 
  font-weight:bold; 
  z-index:10;
  box-shadow:0 0 10px #0ea5e9;
}
#gameOver {
  display:none; 
  position:absolute; 
  inset:0; 
  background:rgba(0,0,0,0.85); 
  color:white; 
  display:flex; 
  align-items:center; 
  justify-content:center; 
  flex-direction:column; 
  font-size:30px; 
  z-index:10;
  opacity:0; 
  transition:opacity 1s ease;
}
#gameOver.show { opacity:1; }
#gameOver button {
  margin-top:20px; 
  padding:12px 25px; 
  font-size:18px; 
  border:none; 
  border-radius:8px; 
  background:#3b82f6; 
  color:white; 
  cursor:pointer; 
  transition:0.3s;
}
#gameOver button:hover { background:#1e40af; }
</style>
</head>
<body>
<div id="hud">PontuaÃ§Ã£o: <span id="score">0</span></div>
<div id="gameOver">
  <div id="msg">ðŸ’¥ BATEU!</div>
  <div>PontuaÃ§Ã£o final: <span id="finalScore">0</span></div>
  <button onclick="restart()">Reiniciar</button>
</div>
<canvas id="game"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

const lanes = [canvas.width/2 - 140, canvas.width/2, canvas.width/2 + 140];
const car = { x: lanes[1], y: canvas.height - 140, w:60, h:100, lane:1, targetX: lanes[1] };
const obstacles = [];
let score=0, gameOver=false, speed=5, spawnTimer=0, roadOffset=0, spawnRate=90;

// fundo estrelado
const stars = Array.from({length:100},()=>({
  x:Math.random()*canvas.width,
  y:Math.random()*canvas.height,
  r:Math.random()*2
}));

function drawStars(){
  ctx.fillStyle="white";
  stars.forEach(s=>{
    ctx.globalAlpha = Math.random()*0.8;
    ctx.beginPath();
    ctx.arc(s.x,s.y,s.r,0,Math.PI*2);
    ctx.fill();
  });
  ctx.globalAlpha=1;
}

// funÃ§Ã£o para desenhar carros mais estilosos
function drawCar(c, isPlayer=true){
  const {x,y,w,h} = c;

  // carro arredondado
  ctx.fillStyle = isPlayer ? "#0ea5e9" : c.color;
  ctx.beginPath();
  ctx.roundRect(x - w/2, y, w, h, 15);
  ctx.fill();

  // vidros
  ctx.fillStyle = isPlayer ? "rgba(180,220,255,0.8)" : "rgba(50,50,50,0.8)";
  ctx.fillRect(x - w/2 + 8, y+15, w-16, 25);
  ctx.fillRect(x - w/2 + 8, y+55, w-16, 25);

  // rodas
  ctx.fillStyle="black";
  ctx.beginPath(); ctx.arc(x - w/2 + 8, y+20, 8, 0, Math.PI*2); ctx.fill();
  ctx.beginPath(); ctx.arc(x + w/2 - 8, y+20, 8, 0, Math.PI*2); ctx.fill();
  ctx.beginPath(); ctx.arc(x - w/2 + 8, y+h-20, 8, 0, Math.PI*2); ctx.fill();
  ctx.beginPath(); ctx.arc(x + w/2 - 8, y+h-20, 8, 0, Math.PI*2); ctx.fill();

  // farÃ³is do jogador
  if(isPlayer){
    ctx.fillStyle="yellow";
    ctx.fillRect(x - w/2, y, 10,12);
    ctx.fillRect(x + w/2 -10, y, 10,12);
  }
}

function updateObstacles(){
  obstacles.forEach((o,i)=>{
    o.y += speed;
    if(o.y>canvas.height){ 
      obstacles.splice(i,1); 
      score+=10; 
      document.getElementById("score").textContent=score; 
    }
    if(o.y+o.h>car.y && o.y<car.y+car.h && Math.abs(o.x-car.x)<(o.w/2+car.w/2)){
      endGame();
    }
  });
}

function spawnObstacle(){
  const lane = Math.floor(Math.random()*3);
  const colors=["#ef4444","#facc15","#22c55e","#f97316","#6366f1"];
  obstacles.push({ x:lanes[lane], y:-120, w:60, h:100, color:colors[Math.floor(Math.random()*colors.length)] });
}

function drawRoad(){
  ctx.fillStyle="#1f2937";
  ctx.fillRect(canvas.width/2 -220,0,440,canvas.height);
  ctx.strokeStyle="#fff";
  ctx.lineWidth=5;
  ctx.setLineDash([40,40]);
  ctx.lineDashOffset=-roadOffset;
  ctx.beginPath();
  ctx.moveTo(canvas.width/2 -140,0); ctx.lineTo(canvas.width/2 -140,canvas.height);
  ctx.moveTo(canvas.width/2 +140,0); ctx.lineTo(canvas.width/2 +140,canvas.height);
  ctx.stroke();
  ctx.setLineDash([]);
}

function loop(){
  if(gameOver) return;
  ctx.clearRect(0,0,canvas.width,canvas.height);
  drawStars();
  drawRoad();
  car.x += (car.targetX - car.x)*0.2;
  drawCar(car,true);
  obstacles.forEach(o=>drawCar(o,false));
  updateObstacles();
  spawnTimer++;
  if(spawnTimer>spawnRate){ 
    spawnObstacle(); 
    spawnTimer=0; 
    if(spawnRate>40) spawnRate-=2; 
  }
  roadOffset += speed; if(roadOffset>80) roadOffset=0;
  requestAnimationFrame(loop);
}

function endGame(){
  gameOver=true;
  document.getElementById("finalScore").textContent=score;
  const gameOverDiv=document.getElementById("gameOver");
  gameOverDiv.style.display="flex";
  setTimeout(()=>gameOverDiv.classList.add("show"),50);
}

window.restart = function(){
  obstacles.length=0;
  car.lane=1; car.x=lanes[1]; car.targetX=lanes[1];
  score=0; speed=5; spawnRate=90;
  document.getElementById("score").textContent=score;
  gameOver=false;
  const gameOverDiv=document.getElementById("gameOver");
  gameOverDiv.style.display="none";
  gameOverDiv.classList.remove("show");
  loop();
}

document.addEventListener("keydown", e=>{
  if(e.key==="ArrowLeft"||e.key==="a"){ if(car.lane>0) car.lane--; }
  if(e.key==="ArrowRight"||e.key==="d"){ if(car.lane<2) car.lane++; }
  car.targetX=lanes[car.lane];
});

setInterval(()=>{ if(!gameOver) speed+=0.3; },4000);

// inicializa
loop();
</script>
</body>
</html>
